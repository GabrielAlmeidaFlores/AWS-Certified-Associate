## EC2 Bootstrap

Bootstrapping in Amazon EC2 (Elastic Compute Cloud) is a powerful feature that enables automation of instance configuration during the launch process. By leveraging User Data, administrators can automate tasks such as software installation, configuration updates, and system initialization.

Key Concepts:

- **Bootstrapping and EC2 Build Automation**: Bootstrapping allows for the automation of EC2 instance setup and configuration during the launch process. It eliminates the need for manual intervention by executing predefined scripts or commands when the instance starts.

- **User Data**: User Data is a mechanism to pass configuration scripts or data to an EC2 instance at launch. It is accessed by the instance via the meta-data API at the following URL: `http://169.254.169.254/latest/user-data`

- **Execution of User Data**: User Data is executed only once during the instance's initial launch. The EC2 service itself does not interpret or execute the User Data; it is the responsibility of the instance's OS to understand and process the provided script or data.

- **Security Considerations**: User Data is not secure and should not be used to store sensitive information such as passwords, API keys, or long-term credentials. It is transmitted and stored in plaintext, making it vulnerable to exposure.

- **Size Limitations**: User Data is limited to 16 KB in size. For larger configurations, consider using external resources like Amazon S3 or a configuration management tool.

- **Modification of User Data**: User Data can be modified when the instance is in a stopped state. However, the modified User Data will only be executed during the next launch of the instance, not during a restart or reboot.

- **Monitor Execution**: Check instance logs (e.g., `/var/log/cloud-init-output.log` for Linux) to verify that User Data scripts executed successfully.

## EC2 Instance Roles

Amazon EC2 Instance Roles provide a secure and scalable way to manage permissions for applications running on EC2 instances. Instead of embedding long-term credentials (like access keys) directly into the instance, you can assign an IAM (Identity and Access Management) role to the instance. This role grants temporary security credentials to the applications running on the instance, allowing them to interact with other AWS services securely.

EC2 Instance Roles Key Concepts:

- **How It Works**: When an IAM role is attached to an EC2 instance, AWS automatically rotates and provides temporary credentials to the instance. These credentials are accessible via the Instance Metadata Service (IMDS) at: `http://169.254.169.254/latest/meta-data/iam/security-credentials/<role-name>`

- **Benefits of Using Instance Roles**

  - **Enhanced Security**: Eliminates the need to store long-term credentials on the instance.
  - **Automatic Credential Rotation**: AWS automatically rotates the temporary credentials, reducing the risk of credential exposure.
  - **Granular Permissions**: IAM roles allow you to define fine-grained permissions for specific AWS services and actions.
  - **Scalability**: Easily attach the same role to multiple instances, ensuring consistent permissions across your infrastructure.

- **Attaching an IAM Role to an EC2 Instance**: An IAM role can be attached to an EC2 instance during launch or after the instance is running. The role must have a trust policy that allows the EC2 service to assume the role.

- **Instance Metadata Service (IMDS)**: The IMDS provides a secure way for instances to retrieve metadata, including IAM role credentials. Access to IMDS can be controlled using IMDSv2, which adds an additional layer of security by requiring a token for access.

- **Limitations**
  - **Role Attachment Limit**: An EC2 instance can have only one IAM role attached at a time.
  - **Credential Lifetime**: Temporary credentials provided by the role are valid for a maximum of 6 hours.
  - **IMDS Access**: If IMDS is disabled, the instance cannot retrieve role credentials.

## SSM Parameter Store

AWS Systems Manager Parameter Store is a secure, scalable, and hierarchical storage service for configuration data and secrets. It enables developers and administrators to centrally manage application parameters, environment variables, and sensitive information across AWS services.

SSM Key Features:

- **Storage for Configuration & Secrets**: Stores configuration values, secrets, API keys, database connection strings, and other sensitive data. Reduces the need to hardcode sensitive information in applications.

- **Parameter Types**

  - **String**: Stores plaintext values (e.g., "AppConfig=Enabled").
  - **StringList**: Stores comma-separated values (e.g., "us-east-1,us-west-2").
  - **SecureString**: Encrypted values using AWS KMS, ideal for passwords and secrets.

- **Use Cases**

  - Storing API keys, database credentials, and tokens securely.
  - Centralized configuration management for applications across environments.
  - Dynamic configuration updates without modifying application code.
  - Secret management without additional services like AWS Secrets Manager.

- **Hierarchical Structure (Folder-like)**: Uses a slash-separated naming convention for better organization. Allows retrieving all parameters under a specific path (`/my-app/prod/`) using APIs or AWS CLI. Example:

- **Versioning**: Each parameter is versioned, enabling rollback and tracking of changes. Example: `/my-app/prod/db-password` may have versions 1, 2, 3.

## CloudWatch agent

You can collect metrics from servers by installing the CloudWatch agent on the server. You can install the agent on both Amazon EC2 instances and on-premises servers. You can also install the agent on computers running Linux, Windows Server, or macOS. If you install the agent on an Amazon EC2 instance, the metrics the agent collects are in addition to the metrics enabled by default on Amazon EC2 instances.

The following table lists the metrics that you can collect with the CloudWatch agent on Linux servers and macOS computers.

| Metric                                 | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| -------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `cpu_time_active`                      | The amount of time that the CPU is active in any capacity. This metric is measured in hundredths of a second.<br><br>Unit: None                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `cpu_time_guest`                       | The amount of time that the CPU is running a virtual CPU for a guest operating system. This metric is measured in hundredths of a second.<br><br>Unit: None                                                                                                                                                                                                                                                                                                                                                                                         |
| `cpu_time_guest_nice`                  | The amount of time that the CPU is running a virtual CPU for a guest operating system, which is low-priority and can be interrupted by other processes. This metric is measured in hundredths of a second.<br><br>Unit: None                                                                                                                                                                                                                                                                                                                        |
| `cpu_time_idle`                        | The amount of time that the CPU is idle. This metric is measured in hundredths of a second.<br><br>Unit: None                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `cpu_time_iowait`                      | The amount of time that the CPU is waiting for I/O operations to complete. This metric is measured in hundredths of a second.<br><br>Unit: None                                                                                                                                                                                                                                                                                                                                                                                                     |
| `cpu_time_irq`                         | The amount of time that the CPU is servicing interrupts. This metric is measured in hundredths of a second.<br><br>Unit: None                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `cpu_time_nice`                        | The amount of time that the CPU is in user mode with low-priority processes, which can easily be interrupted by higher-priority processes. This metric is measured in hundredths of a second.<br><br>Unit: None                                                                                                                                                                                                                                                                                                                                     |
| `cpu_time_softirq`                     | The amount of time that the CPU is servicing software interrupts. This metric is measured in hundredths of a second.<br><br>Unit: None                                                                                                                                                                                                                                                                                                                                                                                                              |
| `cpu_time_steal`                       | The amount of time that the CPU is in _stolen time_, which is time spent in other operating systems in a virtualized environment. This metric is measured in hundredths of a second.<br><br>Unit: None                                                                                                                                                                                                                                                                                                                                              |
| `cpu_time_system`                      | The amount of time that the CPU is in system mode. This metric is measured in hundredths of a second.<br><br>Unit: None                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `cpu_time_user`                        | The amount of time that the CPU is in user mode. This metric is measured in hundredths of a second.<br><br>Unit: None                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `cpu_usage_active`                     | The percentage of time that the CPU is active in any capacity.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `cpu_usage_guest`                      | The percentage of time that the CPU is running a virtual CPU for a guest operating system.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `cpu_usage_guest_nice`                 | The percentage of time that the CPU is running a virtual CPU for a guest operating system, which is low-priority and can be interrupted by other processes.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                    |
| `cpu_usage_idle`                       | The percentage of time that the CPU is idle.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `cpu_usage_iowait`                     | The percentage of time that the CPU is waiting for I/O operations to complete.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `cpu_usage_irq`                        | The percentage of time that the CPU is servicing interrupts.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `cpu_usage_nice`                       | The percentage of time that the CPU is in user mode with low-priority processes, which higher-priority processes can easily interrupt.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                         |
| `cpu_usage_softirq`                    | The percentage of time that the CPU is servicing software interrupts.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `cpu_usage_steal`                      | The percentage of time that the CPU is in _stolen time_, or time spent in other operating systems in a virtualized environment.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                                |
| `cpu_usage_system`                     | The percentage of time that the CPU is in system mode.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `cpu_usage_user`                       | The percentage of time that the CPU is in user mode.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `disk_free`                            | Free space on the disks.<br><br>Unit: Bytes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `disk_inodes_free`                     | The number of available index nodes on the disk.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `disk_inodes_total`                    | The total number of index nodes reserved on the disk.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `disk_inodes_used`                     | The number of used index nodes on the disk.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `disk_total`                           | Total space on the disks, including used and free.<br><br>Unit: Bytes                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `disk_used`                            | Used space on the disks.<br><br>Unit: Bytes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `disk_used_percent`                    | The percentage of total disk space that is used.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `diskio_iops_in_progress`              | The number of I/O requests that have been issued to the device driver but have not yet completed.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `diskio_io_time`                       | The amount of time that the disk has had I/O requests queued.<br><br>Unit: Milliseconds<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                                                                                                                                                                                               |
| `diskio_reads`                         | The number of disk read operations.<br><br>Unit: Count<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                                                                                                                                                                                                                                |
| `diskio_read_bytes`                    | The number of bytes read from the disks.<br><br>Unit: Bytes<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                                                                                                                                                                                                                           |
| `diskio_read_time`                     | The amount of time that read requests have waited on the disks. Multiple read requests waiting at the same time increase the number. For example, if 5 requests all wait for an average of 100 milliseconds, 500 is reported.<br><br>Unit: Milliseconds<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                               |
| `diskio_writes`                        | The number disk write operations.<br><br>Unit: Count<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                                                                                                                                                                                                                                  |
| `diskio_write_bytes`                   | The number of bytes written to the disks.<br><br>Unit: Bytes<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                                                                                                                                                                                                                          |
| `diskio_write_time`                    | The amount of time that write requests have waited on the disks. Multiple write requests waiting at the same time increase the number. For example, if 8 requests all wait for an average of 1000 milliseconds, 8000 is reported.<br><br>Unit: Milliseconds<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                           |
| `ethtool_bw_in_allowance_exceeded`     | The number of packets queued and/or dropped because the inbound aggregate bandwidth exceeded the maximum for the instance.<br><br>This metric is collected only if you have listed it in the `ethtool` subsection of the `metrics_collected` section of the CloudWatch agent configuration file. For more information, see [Collect network performance metrics](./CloudWatch-Agent-network-performance.html)<br><br>Unit: None                                                                                                                     |
| `ethtool_bw_out_allowance_exceeded`    | The number of packets queued and/or dropped because the outbound aggregate bandwidth exceeded the maximum for the instance.<br><br>This metric is collected only if you have listed it in the `ethtool` subsection of the `metrics_collected` section of the CloudWatch agent configuration file. For more information, see [Collect network performance metrics](./CloudWatch-Agent-network-performance.html)<br><br>Unit: None                                                                                                                    |
| `ethtool_conntrack_allowance_exceeded` | The number of packets dropped because connection tracking exceeded the maximum for the instance and new connections could not be established. This can result in packet loss for traffic to or from the instance.<br><br>This metric is collected only if you have listed it in the `ethtool` subsection of the `metrics_collected` section of the CloudWatch agent configuration file. For more information, see [Collect network performance metrics](./CloudWatch-Agent-network-performance.html)<br><br>Unit: None                              |
| `ethtool_linklocal_allowance_exceeded` | The number of packets dropped because the PPS of the traffic to local proxy services exceeded the maximum for the network interface. This impacts traffic to the DNS service, the Instance Metadata Service, and the Amazon Time Sync Service.<br><br>This metric is collected only if you have listed it in the `ethtool` subsection of the `metrics_collected` section of the CloudWatch agent configuration file. For more information, see [Collect network performance metrics](./CloudWatch-Agent-network-performance.html)<br><br>Unit: None |
| `ethtool_pps_allowance_exceeded`       | The number of packets queued and/or dropped because the bidirectional PPS exceeded the maximum for the instance.<br><br>This metric is collected only if you have listed it in the `ethtool` subsection of the `metrics_collected` section of the CloudWatch agent configuration file. For more information, see [Collect network performance metrics](./CloudWatch-Agent-network-performance.html).<br><br>Unit: None                                                                                                                              |
| `mem_active`                           | The amount of memory that has been used in some way during the last sample period.<br><br>Unit: Bytes                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `mem_available`                        | The amount of memory that is available and can be given instantly to processes.<br><br>Unit: Bytes                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `mem_available_percent`                | The percentage of memory that is available and can be given instantly to processes.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `mem_buffered`                         | The amount of memory that is being used for buffers.<br><br>Unit: Bytes                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `mem_cached`                           | The amount of memory that is being used for file caches.<br><br>Unit: Bytes                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `mem_free`                             | The amount of memory that isn't being used.<br><br>Unit: Bytes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `mem_inactive`                         | The amount of memory that hasn't been used in some way during the last sample period<br><br>Unit: Bytes                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `mem_total`                            | The total amount of memory.<br><br>Unit: Bytes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `mem_used`                             | The amount of memory currently in use.<br><br>Unit: Bytes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `mem_used_percent`                     | The percentage of memory currently in use.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `net_bytes_recv`                       | The number of bytes received by the network interface.<br><br>Unit: Bytes<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                                                                                                                                                                                                             |
| `net_bytes_sent`                       | The number of bytes sent by the network interface.<br><br>Unit: Bytes<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                                                                                                                                                                                                                 |
| `net_drop_in`                          | The number of packets received by this network interface that were dropped.<br><br>Unit: Count<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                                                                                                                                                                                        |
| `net_drop_out`                         | The number of packets transmitted by this network interface that were dropped.<br><br>Unit: Count<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                                                                                                                                                                                     |
| `net_err_in`                           | The number of receive errors detected by this network interface.<br><br>Unit: Count<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                                                                                                                                                                                                   |
| `net_err_out`                          | The number of transmit errors detected by this network interface.<br><br>Unit: Count<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                                                                                                                                                                                                  |
| `net_packets_sent`                     | The number of packets sent by this network interface.<br><br>Unit: Count<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                                                                                                                                                                                                              |
| `net_packets_recv`                     | The number of packets received by this network interface.<br><br>Unit: Count<br><br>The only statistic that should be used for this metric is `Sum`. Do not use `Average`.                                                                                                                                                                                                                                                                                                                                                                          |
| `netstat_tcp_close`                    | The number of TCP connections with no state.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `netstat_tcp_close_wait`               | The number of TCP connections waiting for a termination request from the client.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `netstat_tcp_closing`                  | The number of TCP connections that are waiting for a termination request with acknowledgement from the client.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `netstat_tcp_established`              | The number of TCP connections established.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `netstat_tcp_fin_wait1`                | The number of TCP connections in the `FIN_WAIT1` state during the process of closing a connection.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `netstat_tcp_fin_wait2`                | The number of TCP connections in the `FIN_WAIT2` state during the process of closing a connection.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `netstat_tcp_last_ack`                 | The number of TCP connections waiting for the client to send acknowledgement of the connection termination message. This is the last state right before the connection is closed down.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                           |
| `netstat_tcp_listen`                   | The number of TCP ports currently listening for a connection request.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `netstat_tcp_none`                     | The number of TCP connections with inactive clients.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `netstat_tcp_syn_sent`                 | The number of TCP connections waiting for a matching connection request after having sent a connection request.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `netstat_tcp_syn_recv`                 | The number of TCP connections waiting for connection request acknowledgement after having sent and received a connection request.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                |
| `netstat_tcp_time_wait`                | The number of TCP connections currently waiting to ensure that the client received the acknowledgement of its connection termination request.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                    |
| `netstat_udp_socket`                   | The number of current UDP connections.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `processes_blocked`                    | The number of processes that are blocked.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `processes_dead`                       | The number of processes that are dead, indicated by the `X` state code on Linux.<br><br>This metric is not collected on macOS computers.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                         |
| `processes_idle`                       | The number of processes that are idle (sleeping for more than 20 seconds). Available only on FreeBSD instances.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `processes_paging`                     | The number of processes that are paging, indicated by the `W` state code on Linux.<br><br>This metric is not collected on macOS computers.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                       |
| `processes_running`                    | The number of processes that are running, indicated by the `R` state code.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `processes_sleeping`                   | The number of processes that are sleeping, indicated by the `S` state code.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `processes_stopped`                    | The number of processes that are stopped, indicated by the `T` state code.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `processes_total`                      | The total number of processes on the instance.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `processes_total_threads`              | The total number of threads making up the processes. This metric is available only on Linux instances.<br><br>This metric is not collected on macOS computers.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                   |
| `processes_wait`                       | The number of processes that are paging, indicated by the `W` state code on FreeBSD instances. This metric is available only on FreeBSD instances, and is not available on Linux, Windows Server, or macOS instances.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                            |
| `processes_zombies`                    | The number of zombie processes, indicated by the `Z` state code.<br><br>Unit: Count                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `swap_free`                            | The amount of swap space that isn't being used.<br><br>Unit: Bytes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `swap_used`                            | The amount of swap space currently in use.<br><br>Unit: Bytes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `swap_used_percent`                    | The percentage of swap space currently in use.<br><br>Unit: Percent                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
